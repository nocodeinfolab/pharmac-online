<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online Pharmacy</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <style>
        :root {
            --primary-color: #4a89dc;
            --secondary-color: #3bafda;
            --accent-color: #e6e9ed;
            --text-color: #434a54;
            --light-text: #aab2bd;
            --success-color: #8cc152;
            --warning-color: #f6bb42;
            --danger-color: #da4453;
            --white: #ffffff;
            --light-bg: #f5f7fa;
            --border-radius: 8px;
            --box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--light-bg);
            color: var(--text-color);
            line-height: 1.6;
            padding-bottom: 60px;
        }

        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: var(--white);
            padding: 15px;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--box-shadow);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .cart-icon {
            position: relative;
            font-size: 1.3rem;
        }

        .cart-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: var(--danger-color);
            color: var(--white);
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
        }

        .search-container {
            padding: 10px 15px;
            background-color: var(--white);
        }

        .search-box {
            display: flex;
            margin-bottom: 10px;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--box-shadow);
        }

        .search-input {
            flex: 1;
            padding: 12px 15px;
            border: none;
            font-size: 1rem;
        }

        .search-button {
            background-color: var(--primary-color);
            color: var(--white);
            border: none;
            padding: 0 15px;
            cursor: pointer;
        }

        .search-tabs {
            display: flex;
            margin-bottom: 10px;
        }

        .search-tab {
            flex: 1;
            text-align: center;
            padding: 10px;
            background-color: var(--accent-color);
            border: none;
            font-size: 0.9rem;
            cursor: pointer;
        }

        .search-tab.active {
            background-color: var(--primary-color);
            color: var(--white);
        }

        .search-tab:first-child {
            border-radius: var(--border-radius) 0 0 var(--border-radius);
        }

        .search-tab:last-child {
            border-radius: 0 var(--border-radius) var(--border-radius) 0;
        }

        .categories-container {
            padding: 0 15px;
        }

        .category-section {
            margin-bottom: 20px;
        }

        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px 0;
            border-bottom: 1px solid var(--accent-color);
        }

        .category-title {
            font-size: 1.2rem;
            font-weight: 500;
            color: var(--primary-color);
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .product-card {
            background-color: var(--white);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--box-shadow);
            transition: transform 0.2s;
        }

        .product-card:active {
            transform: scale(0.98);
        }

        .product-image {
            width: 100%;
            height: 120px;
            object-fit: contain;
            background-color: var(--light-bg);
            padding: 10px;
        }

        .product-info {
            padding: 10px;
        }

        .product-name {
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 5px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .product-brand {
            font-size: 0.8rem;
            color: var(--light-text);
            margin-bottom: 5px;
        }

        .product-price {
            font-size: 1rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .product-stock {
            font-size: 0.7rem;
            padding: 3px 6px;
            border-radius: 4px;
            background-color: var(--success-color);
            color: var(--white);
            display: inline-block;
        }

        .prescription-badge {
            font-size: 0.7rem;
            padding: 3px 6px;
            border-radius: 4px;
            background-color: var(--warning-color);
            color: var(--white);
            display: inline-block;
            margin-left: 5px;
        }

        .see-more-btn {
            display: block;
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            background-color: var(--accent-color);
            border: none;
            border-radius: var(--border-radius);
            color: var(--primary-color);
            font-weight: 500;
            cursor: pointer;
        }

        .hidden {
            display: none;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: var(--light-text);
        }

        .spinner {
            border: 3px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 3px solid var(--primary-color);
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .no-results {
            text-align: center;
            padding: 30px;
            color: var(--light-text);
            grid-column: span 2;
        }

        footer {
            position: fixed;
            bottom: 0;
            width: 100%;
            background-color: var(--white);
            padding: 10px 0;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-around;
        }

        .footer-icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--light-text);
            font-size: 0.8rem;
        }

        .footer-icon i {
            font-size: 1.2rem;
            margin-bottom: 3px;
        }

        .footer-icon.active {
            color: var(--primary-color);
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo">Pharmac-Online</div>
            <div class="cart-icon">
                <i class="fas fa-shopping-cart"></i>
                <span class="cart-count">0</span>
            </div>
        </div>
    </header>

    <div class="search-container">
        <div class="search-tabs">
            <button class="search-tab active" data-tab="name">Search by Name</button>
            <button class="search-tab" data-tab="tags">Search by Tags</button>
        </div>
        <div class="search-box">
            <input type="text" class="search-input" id="search-input" placeholder="Search medications...">
            <button class="search-button" id="search-button">
                <i class="fas fa-search"></i>
            </button>
        </div>
    </div>

    <div class="categories-container" id="categories-container">
        <div class="loading">
            <div class="spinner"></div>
            <p>Loading medications...</p>
        </div>
    </div>

    <footer>
        <div class="footer-icon active">
            <i class="fas fa-home"></i>
            <span>Home</span>
        </div>
        <div class="footer-icon">
            <i class="fas fa-search"></i>
            <span>Search</span>
        </div>
        <div class="footer-icon">
            <i class="fas fa-prescription"></i>
            <span>Prescriptions</span>
        </div>
        <div class="footer-icon">
            <i class="fas fa-user"></i>
            <span>Account</span>
        </div>
    </footer>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCNMdcbXVMC_QUgVSmgFMXlW84DWQs9QZE",
            authDomain: "pharmac-online.firebaseapp.com",
            projectId: "pharmac-online",
            storageBucket: "pharmac-online.appspot.com",
            messagingSenderId: "968868548902",
            appId: "1:968868548902:android:0607bd63857c7c538131e7"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // DOM elements
        const categoriesContainer = document.getElementById('categories-container');
        const searchInput = document.getElementById('search-input');
        const searchButton = document.getElementById('search-button');
        const searchTabs = document.querySelectorAll('.search-tab');
        let currentSearchType = 'name';

        // Global variables
        let allProducts = [];
        let cartCount = 0;

        // Event listeners
        searchButton.addEventListener('click', handleSearch);
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') handleSearch();
        });

        searchTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                searchTabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                currentSearchType = tab.dataset.tab;
                searchInput.placeholder = currentSearchType === 'name' 
                    ? 'Search medications...' 
                    : 'Search by tags like pain, fever...';
                if (searchInput.value) handleSearch();
            });
        });

        // Initialize the app
        document.addEventListener('DOMContentLoaded', fetchProducts);

        // Functions
        async function fetchProducts() {
            try {
                const querySnapshot = await db.collection('Products')
                    .where('stock', '==', 'Available')
                    .get();
                
                allProducts = querySnapshot.docs.map(doc => {
                    const data = doc.data();
                    return {
                        id: doc.id,
                        ...data,
                        category: data.category || 'Other',
                        tags: data.tags || []
                    };
                });

                displayProductsByCategory(allProducts);
            } catch (error) {
                console.error("Error fetching products: ", error);
                categoriesContainer.innerHTML = `
                    <div class="no-results">
                        <p>Failed to load products. Please try again later.</p>
                    </div>
                `;
            }
        }

        function displayProductsByCategory(products) {
            if (products.length === 0) {
                categoriesContainer.innerHTML = `
                    <div class="no-results">
                        <p>No medications found.</p>
                    </div>
                `;
                return;
            }

            // Group products by category
            const categories = {};
            products.forEach(product => {
                if (!categories[product.category]) {
                    categories[product.category] = [];
                }
                categories[product.category].push(product);
            });

            // Display each category
            categoriesContainer.innerHTML = '';
            for (const [category, categoryProducts] of Object.entries(categories)) {
                const categorySection = document.createElement('div');
                categorySection.className = 'category-section';
                
                const categoryHeader = document.createElement('div');
                categoryHeader.className = 'category-header';
                categoryHeader.innerHTML = `
                    <h2 class="category-title">${category}</h2>
                `;
                
                const productsGrid = document.createElement('div');
                productsGrid.className = 'products-grid';
                
                // Display first 10 products
                const visibleProducts = categoryProducts.slice(0, 10);
                visibleProducts.forEach(product => {
                    productsGrid.appendChild(createProductCard(product));
                });
                
                categorySection.appendChild(categoryHeader);
                categorySection.appendChild(productsGrid);
                
                // Add "See More" button if there are more products
                if (categoryProducts.length > 10) {
                    const seeMoreBtn = document.createElement('button');
                    seeMoreBtn.className = 'see-more-btn';
                    seeMoreBtn.textContent = 'See More';
                    seeMoreBtn.dataset.category = category;
                    seeMoreBtn.dataset.offset = 10;
                    
                    seeMoreBtn.addEventListener('click', function() {
                        const offset = parseInt(this.dataset.offset);
                        const nextProducts = categoryProducts.slice(offset, offset + 10);
                        
                        nextProducts.forEach(product => {
                            productsGrid.appendChild(createProductCard(product));
                        });
                        
                        this.dataset.offset = offset + 10;
                        
                        if (offset + 10 >= categoryProducts.length) {
                            this.style.display = 'none';
                        }
                    });
                    
                    categorySection.appendChild(seeMoreBtn);
                }
                
                categoriesContainer.appendChild(categorySection);
            }
        }

        function createProductCard(product) {
            const card = document.createElement('div');
            card.className = 'product-card';
            card.dataset.id = product.id;
            card.dataset.name = product.productName.toLowerCase();
            card.dataset.tags = product.tags.join(',').toLowerCase();
            
            card.innerHTML = `
                <img src="${product.imageUrl || 'https://via.placeholder.com/150?text=No+Image'}" alt="${product.productName}" class="product-image">
                <div class="product-info">
                    <h3 class="product-name">${product.productName}</h3>
                    <p class="product-brand">${product.brandName || 'Generic'}</p>
                    <p class="product-price">$${product.price.toFixed(2)}</p>
                    <span class="product-stock">In Stock</span>
                    ${product.prescriptionRequired ? '<span class="prescription-badge">Rx</span>' : ''}
                </div>
            `;
            
            card.addEventListener('click', () => {
                // In a real app, you would navigate to a product detail page
                alert(`Selected: ${product.productName}\nPrice: $${product.price.toFixed(2)}`);
            });
            
            return card;
        }

        function handleSearch() {
            const searchTerm = searchInput.value.trim().toLowerCase();
            
            if (!searchTerm) {
                displayProductsByCategory(allProducts);
                return;
            }
            
            let filteredProducts;
            
            if (currentSearchType === 'name') {
                filteredProducts = allProducts.filter(product => 
                    product.productName.toLowerCase().includes(searchTerm) ||
                    product.brandName.toLowerCase().includes(searchTerm)
                );
            } else { // search by tags
                filteredProducts = allProducts.filter(product => 
                    product.tags.some(tag => tag.toLowerCase().includes(searchTerm))
                );
            }
            
            displayProductsByCategory(filteredProducts);
        }
    </script>
</body>
</html>
